#!/bin/bash
set -e -u -o pipefail
: "${DMC_UNARCHIVE:=unzip -p}"
: "${DMC_ENCODING:=UTF-8}"
Main() {
	# This is not memory nor CPU efficient
	# iconv will load the ENTIRE file into memory during conversion
	# and sed will churn hard on files that don't need to be updated
	# It's also ONLY needed ONCE per load of a file
	${DMC_UNARCHIVE:+ ${DMC_UNARCHIVE}} "$1" ${2:+"${2}"} |
		iconv -f "${DMC_ENCODING}" -t UTF-8 - |
		sed -e 's/\o0//g'
}
Main "$@"
