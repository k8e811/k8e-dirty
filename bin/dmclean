#!/bin/bash
set -e -u -o pipefail
: "${DMC_UNARCHIVE:=unzip -p}" Unarchive cmd
: "${DMC_ENCODING:=UTF-8}" Input encoding
: "${DMC_FORMAT:=tabs}" tabs or csv
: "${DMC_FIX:=${DMC_FORMAT}_fix}" And the fixer script
Main() {
	# This is not memory nor CPU efficient
	# iconv will load the ENTIRE file into memory during conversion
	# and sed will churn hard on files that don't need to be updated
	# It's also ONLY needed ONCE per load of a file
	SedArgs 1>&2
	${DMC_UNARCHIVE:+ ${DMC_UNARCHIVE}} "$1" ${2:+"${2}"} |
		iconv -f "${DMC_ENCODING}" -t UTF-8 - |
		"${DMC_FIX}"
}
Main "$@"
